/*
            RUTA: /api/usuarios

*/

const { Router } = require('express');
const { check } = require('express-validator');
const { validarCampos } = require('../middlewares/validar-campos');
const { validarJWT } = require('../middlewares/validar-jwt');

const { getUsuarios, crearUsuario, actualizarPerfil, statusUsuario,RoleUsuario, buscarUsuario,CambiarRole } = require('../controllers/usuario.controllers');

const router = Router();


////////////////////////////////////////////////////////////////////////////
//regresa a todos los usuarios
////////////////////////////////////////////////////////////////////////////
router.get('/', validarJWT, getUsuarios)


////////////////////////////////////////////////////////////////////////////
// crear Usuarios nuevos
////////////////////////////////////////////////////////////////////////////
router.post(
    '/',
    [
        check('nombre', 'El nombre es obligatorio').not().isEmpty(),
        check('control', 'El control es obligatorio').not().isEmpty(),
        check('password', 'El password es obligatorio').not().isEmpty(),
        validarCampos,
    ],
    crearUsuario);


/////////////////////////////////////////////////////////////////////////////
//actualizar perfil de usuaio propio
/////////////////////////////////////////////////////////////////////////////
router.put('/:id',
    [
        check('nombre', 'El nombre es obligatorio').not().isEmpty(),
        //check('uid','Debe ser un id valido de Mongo').isMongoId(),
        validarCampos,
    ],
    actualizarPerfil);


//////////////////////////////////////////////////////////////////////////////
//cambiar estatus de usuario
//////////////////////////////////////////////////////////////////////////////
router.put('/:id/:stat',
[
    validarJWT,
    ],
    statusUsuario);

//////////////////////////////////////////////////////////////////////////////
//cambiar role de usuairo po rid
//////////////////////////////////////////////////////////////////////////////

router.put('/cambiar/role/:uid',
[
    check('role', 'El rol es obligatorio').not().isEmpty(),
    validarJWT
],
CambiarRole)

//////////////////////////////////////////////////////////////////////////////
//buscar usuario por id
//////////////////////////////////////////////////////////////////////////////
router.get('/:id', buscarUsuario);

//////////////////////////////////////////////////////////////////////////////
//cargar ROle de usuario por ID
//////////////////////////////////////////////////////////////////////////////
router.get('/buscar/role/:id',validarJWT, RoleUsuario)

module.exports = router;